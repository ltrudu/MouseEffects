<UserControl x:Class="MouseEffects.Effects.ColorBlindnessNG.UI.ZoneSettingsEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:MouseEffects.Effects.ColorBlindnessNG.UI"
             mc:Ignorable="d" d:DesignWidth="320">
    <UserControl.Resources>
        <Style TargetType="TextBlock" x:Key="LabelStyle">
            <Setter Property="Margin" Value="0,8,0,4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style TargetType="Slider" x:Key="SliderStyle">
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>
        <Style TargetType="TextBlock" x:Key="ValueStyle">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Opacity" Value="0.7"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
    </UserControl.Resources>

    <StackPanel Margin="0,8,0,0">
        <!-- Zone Mode -->
        <TextBlock Text="Mode" Style="{StaticResource LabelStyle}"/>
        <ComboBox x:Name="ModeCombo" SelectionChanged="ModeCombo_SelectionChanged" Margin="0,0,0,8">
            <ComboBoxItem Content="Original (no processing)"/>
            <ComboBoxItem Content="Simulation (show CVD view)"/>
            <ComboBoxItem Content="Correction (enhance colors)"/>
            <ComboBoxItem x:Name="ReSimulationItem" Content="Re-simulation (apply to another zone)"/>
        </ComboBox>

        <!-- Simulation Settings -->
        <StackPanel x:Name="SimulationPanel" Visibility="Collapsed">
            <TextBlock Text="Algorithm" Style="{StaticResource LabelStyle}"/>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <RadioButton x:Name="MachadoRadio" Content="Machado" IsChecked="True"
                             Checked="Algorithm_Changed" Margin="0,0,16,0"/>
                <RadioButton x:Name="StrictRadio" Content="Strict (LMS)"
                             Checked="Algorithm_Changed"/>
            </StackPanel>

            <TextBlock Text="CVD Type" Style="{StaticResource LabelStyle}"/>
            <ComboBox x:Name="SimFilterCombo" SelectionChanged="SimFilter_Changed" Margin="0,0,0,8">
                <ComboBoxItem Content="None"/>
                <ComboBoxItem Content="Protanopia (red-blind)"/>
                <ComboBoxItem Content="Protanomaly (red-weak)"/>
                <ComboBoxItem Content="Deuteranopia (green-blind)"/>
                <ComboBoxItem Content="Deuteranomaly (green-weak)"/>
                <ComboBoxItem Content="Tritanopia (blue-blind)"/>
                <ComboBoxItem Content="Tritanomaly (blue-weak)"/>
                <ComboBoxItem Content="Achromatopsia"/>
                <ComboBoxItem Content="Achromatomaly"/>
            </ComboBox>
        </StackPanel>

        <!-- Re-simulation Settings -->
        <StackPanel x:Name="ReSimulationPanel" Visibility="Collapsed">
            <TextBlock Text="Takes another zone's processed output and applies CVD simulation on top."
                       TextWrapping="Wrap" Foreground="#CCCCCC" FontSize="12" Margin="0,0,0,8"/>
            <TextBlock Text="Source Zone" Style="{StaticResource LabelStyle}"/>
            <ComboBox x:Name="ReSimSourceZoneCombo" SelectionChanged="ReSimSourceZone_Changed" Margin="0,0,0,8"/>

            <TextBlock Text="Algorithm" Style="{StaticResource LabelStyle}"/>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <RadioButton x:Name="ReSimMachadoRadio" Content="Machado" IsChecked="True"
                             Checked="ReSimAlgorithm_Changed" Margin="0,0,16,0"/>
                <RadioButton x:Name="ReSimStrictRadio" Content="Strict (LMS)"
                             Checked="ReSimAlgorithm_Changed"/>
            </StackPanel>

            <TextBlock Text="CVD Type" Style="{StaticResource LabelStyle}"/>
            <ComboBox x:Name="ReSimFilterCombo" SelectionChanged="ReSimFilter_Changed" Margin="0,0,0,8">
                <ComboBoxItem Content="Protanopia (red-blind)"/>
                <ComboBoxItem Content="Protanomaly (red-weak)"/>
                <ComboBoxItem Content="Deuteranopia (green-blind)" IsSelected="True"/>
                <ComboBoxItem Content="Deuteranomaly (green-weak)"/>
                <ComboBoxItem Content="Tritanopia (blue-blind)"/>
                <ComboBoxItem Content="Tritanomaly (blue-weak)"/>
                <ComboBoxItem Content="Achromatopsia"/>
                <ComboBoxItem Content="Achromatomaly"/>
            </ComboBox>

            <TextBlock x:Name="ReSimIntensityLabel" Text="Intensity (1.00)" Style="{StaticResource LabelStyle}"/>
            <Slider x:Name="ReSimIntensitySlider" Minimum="0" Maximum="1" Value="1"
                    Style="{StaticResource SliderStyle}" ValueChanged="ReSimIntensity_Changed"/>
        </StackPanel>

        <!-- Correction Settings -->
        <StackPanel x:Name="CorrectionPanel" Visibility="Collapsed">
            <!-- Correction Algorithm Selection -->
            <TextBlock Text="Correction Algorithm" Style="{StaticResource LabelStyle}"/>
            <ComboBox x:Name="CorrectionAlgorithmCombo" SelectionChanged="CorrectionAlgorithm_Changed" Margin="0,0,0,8">
                <ComboBoxItem Content="LUT-Based (Color Remapping)" IsSelected="True"/>
                <ComboBoxItem Content="Daltonization (Error Redistribution)"/>
                <ComboBoxItem Content="Hue Rotation (Color Shift)"/>
                <ComboBoxItem Content="CIELAB Remapping (Perceptual)"/>
            </ComboBox>

            <!-- Algorithm Descriptions (shown based on selected algorithm) -->
            <TextBlock x:Name="LUTDescriptionText"
                       Text="Remaps colors using per-channel gradients. Choose a preset or customize each color channel's transformation."
                       TextWrapping="Wrap" Foreground="#CCCCCC" FontSize="12" Margin="0,0,0,8"/>
            <TextBlock x:Name="DaltonizationDescriptionText" Visibility="Collapsed"
                       Text="Daltonization corrects colors by simulating how a CVD person sees them, then redistributing the 'lost' color information into channels they can perceive."
                       TextWrapping="Wrap" Foreground="#CCCCCC" FontSize="12" Margin="0,0,0,8"/>
            <TextBlock x:Name="HueRotationDescriptionText" Visibility="Collapsed"
                       Text="Rotates problematic hue ranges to more distinguishable positions on the color wheel."
                       TextWrapping="Wrap" Foreground="#CCCCCC" FontSize="12" Margin="0,0,0,8"/>
            <TextBlock x:Name="CIELABDescriptionText" Visibility="Collapsed"
                       Text="Transfers color information between perceptual axes (red-green to blue-yellow)."
                       TextWrapping="Wrap" Foreground="#CCCCCC" FontSize="12" Margin="0,0,0,8"/>

            <!-- Simulation-Guided Correction (shared by all algorithms) -->
            <StackPanel x:Name="SimGuidedSharedPanel" Visibility="Collapsed">
                <CheckBox x:Name="SimGuidedCheckBox" Content="Simulation-Guided Correction"
                          Margin="0,0,0,4"
                          ToolTip="Only apply correction to pixels that would be affected by CVD (detected via simulation)"
                          Checked="SimGuided_Changed" Unchecked="SimGuided_Changed"/>
                <StackPanel x:Name="SimGuidedPanel" Visibility="Collapsed" Margin="16,0,0,0">
                    <TextBlock Text="Detection Algorithm" Style="{StaticResource LabelStyle}"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <RadioButton x:Name="SimGuidedMachadoRadio" Content="Machado" IsChecked="True"
                                     Checked="SimGuidedAlgorithm_Changed" Margin="0,0,16,0"/>
                        <RadioButton x:Name="SimGuidedStrictRadio" Content="Strict (LMS)"
                                     Checked="SimGuidedAlgorithm_Changed"/>
                    </StackPanel>
                    <TextBlock Text="CVD Type to Detect" Style="{StaticResource LabelStyle}"/>
                    <ComboBox x:Name="SimGuidedFilterCombo" SelectionChanged="SimGuidedFilter_Changed" Margin="0,0,0,8">
                        <ComboBoxItem Content="Protanopia (Red-Green blind)"/>
                        <ComboBoxItem Content="Protanomaly (Red-Green weak)"/>
                        <ComboBoxItem Content="Deuteranopia (Green-Red blind)" IsSelected="True"/>
                        <ComboBoxItem Content="Deuteranomaly (Green-Red weak)"/>
                        <ComboBoxItem Content="Tritanopia (Blue-Yellow blind)"/>
                        <ComboBoxItem Content="Tritanomaly (Blue-Yellow weak)"/>
                        <ComboBoxItem Content="Achromatopsia (No color)"/>
                        <ComboBoxItem Content="Achromatomaly (Weak color)"/>
                    </ComboBox>
                    <TextBlock x:Name="SimGuidedSensitivityLabel" Text="Sensitivity (2.00)" Style="{StaticResource LabelStyle}"
                               ToolTip="Lower = only strongly affected pixels, Higher = more pixels corrected"/>
                    <Slider x:Name="SimGuidedSensitivitySlider" Minimum="0.5" Maximum="25" Value="2"
                            Style="{StaticResource SliderStyle}" ValueChanged="SimGuidedSensitivity_Changed"/>
                </StackPanel>
                <Separator Margin="0,8,0,8"/>
            </StackPanel>

            <!-- Hue Rotation Settings -->
            <StackPanel x:Name="HueRotationPanel" Visibility="Collapsed">
                <TextBlock Text="CVD Type to Correct" Style="{StaticResource LabelStyle}"/>
                <ComboBox x:Name="HueRotationCVDCombo" SelectionChanged="HueRotationCVD_Changed" Margin="0,0,0,8">
                    <ComboBoxItem Content="Protanopia (red-blind)"/>
                    <ComboBoxItem Content="Protanomaly (red-weak)"/>
                    <ComboBoxItem Content="Deuteranopia (green-blind)" IsSelected="True"/>
                    <ComboBoxItem Content="Deuteranomaly (green-weak)"/>
                    <ComboBoxItem Content="Tritanopia (blue-blind)"/>
                    <ComboBoxItem Content="Tritanomaly (blue-weak)"/>
                </ComboBox>
                <TextBlock x:Name="HueRotationStrengthLabel" Text="Strength (1.00)" Style="{StaticResource LabelStyle}"/>
                <Slider x:Name="HueRotationStrengthSlider" Minimum="0" Maximum="1" Value="1"
                        Style="{StaticResource SliderStyle}" ValueChanged="HueRotationStrength_Changed"/>
                <StackPanel Orientation="Horizontal" Margin="0,8,0,4">
                    <CheckBox x:Name="HueRotationAdvancedCheckBox" Content="Advanced Options"
                              VerticalAlignment="Center"
                              Checked="HueRotationAdvanced_Changed" Unchecked="HueRotationAdvanced_Changed"/>
                    <Button x:Name="HueRotationResetButton" Content="Reset" Margin="8,0,0,0"
                            Padding="8,2" FontSize="11" Click="HueRotationReset_Click"
                            ToolTip="Reset advanced values to defaults for the selected CVD type"/>
                </StackPanel>
                <StackPanel x:Name="HueRotationAdvancedPanel" Visibility="Collapsed">
                    <!-- Color Wheel Selector -->
                    <TextBlock Text="Drag handles to adjust hue range and shift"
                               FontSize="11" Foreground="#AAAAAA" Margin="0,4,0,4"/>
                    <local:HueWheelSelector x:Name="HueWheelControl"
                                            Height="180" Margin="0,4,0,8"
                                            ValueChanged="HueWheel_ValueChanged"/>
                    <!-- Legend -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                        <Ellipse Width="12" Height="12" Fill="LimeGreen" Margin="0,0,4,0"/>
                        <TextBlock Text="Start" FontSize="10" Foreground="#AAAAAA" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        <Ellipse Width="12" Height="12" Fill="OrangeRed" Margin="0,0,4,0"/>
                        <TextBlock Text="End" FontSize="10" Foreground="#AAAAAA" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        <Ellipse Width="12" Height="12" Fill="Gold" Margin="0,0,4,0"/>
                        <TextBlock Text="Shift" FontSize="10" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                    </StackPanel>
                    <!-- Value labels -->
                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock x:Name="HueRotationSourceStartLabel" Text="Start: 0°"
                                   Grid.Column="0" FontSize="11" Foreground="#CCCCCC" HorizontalAlignment="Center"/>
                        <TextBlock x:Name="HueRotationSourceEndLabel" Text="End: 120°"
                                   Grid.Column="1" FontSize="11" Foreground="#CCCCCC" HorizontalAlignment="Center"/>
                        <TextBlock x:Name="HueRotationShiftLabel" Text="Shift: +60°"
                                   Grid.Column="2" FontSize="11" Foreground="#CCCCCC" HorizontalAlignment="Center"/>
                    </Grid>
                    <!-- Falloff slider (not easily shown on wheel) -->
                    <TextBlock x:Name="HueRotationFalloffLabel" Text="Edge Falloff (0.30)" Style="{StaticResource LabelStyle}"/>
                    <Slider x:Name="HueRotationFalloffSlider" Minimum="0" Maximum="1" Value="0.3"
                            Style="{StaticResource SliderStyle}" ValueChanged="HueRotationFalloff_Changed"/>
                </StackPanel>
            </StackPanel>

            <!-- CIELAB Remapping Settings -->
            <StackPanel x:Name="CIELABPanel" Visibility="Collapsed">
                <TextBlock Text="CVD Type to Correct" Style="{StaticResource LabelStyle}"/>
                <ComboBox x:Name="CIELABCVDCombo" SelectionChanged="CIELABCVD_Changed" Margin="0,0,0,8">
                    <ComboBoxItem Content="Protanopia (red-blind)"/>
                    <ComboBoxItem Content="Protanomaly (red-weak)"/>
                    <ComboBoxItem Content="Deuteranopia (green-blind)" IsSelected="True"/>
                    <ComboBoxItem Content="Deuteranomaly (green-weak)"/>
                    <ComboBoxItem Content="Tritanopia (blue-blind)"/>
                    <ComboBoxItem Content="Tritanomaly (blue-weak)"/>
                </ComboBox>
                <TextBlock x:Name="CIELABStrengthLabel" Text="Strength (1.00)" Style="{StaticResource LabelStyle}"/>
                <Slider x:Name="CIELABStrengthSlider" Minimum="0" Maximum="1" Value="1"
                        Style="{StaticResource SliderStyle}" ValueChanged="CIELABStrength_Changed"/>

                <!-- Color Transformation Preview -->
                <TextBlock Text="Color Transformation Preview" Style="{StaticResource LabelStyle}" Margin="0,8,0,4"/>
                <local:CIELABPreviewStrip x:Name="CIELABPreview" Height="60" Margin="0,0,0,8"/>

                <StackPanel Orientation="Horizontal" Margin="0,8,0,4">
                    <CheckBox x:Name="CIELABAdvancedCheckBox" Content="Advanced Options"
                              VerticalAlignment="Center"
                              Checked="CIELABAdvanced_Changed" Unchecked="CIELABAdvanced_Changed"/>
                    <Button x:Name="CIELABResetButton" Content="Reset" Margin="8,0,0,0"
                            Padding="8,2" FontSize="11" Click="CIELABReset_Click"
                            ToolTip="Reset advanced values to defaults for the selected CVD type"/>
                </StackPanel>
                <StackPanel x:Name="CIELABAdvancedPanel" Visibility="Collapsed" Margin="0,0,0,0">
                    <!-- Interactive a*b* Axis Control -->
                    <TextBlock Text="Axis Transfer Control" Style="{StaticResource LabelStyle}"/>
                    <TextBlock Text="Drag handles to adjust transfer between color axes"
                               FontSize="11" Foreground="#AAAAAA" Margin="0,0,0,4"/>
                    <local:CIELABAxisControl x:Name="CIELABAxisControl"
                                             Height="180" Width="180" Margin="0,4,0,8"
                                             HorizontalAlignment="Left"
                                             ValueChanged="CIELABAxis_ValueChanged"/>
                    <!-- Legend -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Ellipse Width="12" Height="12" Fill="#FF9632" Margin="0,0,4,0"/>
                        <TextBlock Text="a*→b*" FontSize="10" Foreground="#AAAAAA" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        <Ellipse Width="12" Height="12" Fill="#3296FF" Margin="0,0,4,0"/>
                        <TextBlock Text="b*→a*" FontSize="10" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Enhancement Sliders -->
                    <Separator Margin="0,4,0,8"/>
                    <TextBlock Text="Axis Enhancement" Style="{StaticResource LabelStyle}"/>
                    <TextBlock x:Name="CIELABAEnhanceLabel" Text="a* Enhancement (1.00)" Style="{StaticResource LabelStyle}"
                               FontWeight="Normal" FontSize="12" Margin="0,4,0,2"
                               ToolTip="Increase red-green contrast"/>
                    <Slider x:Name="CIELABAEnhanceSlider" Minimum="0" Maximum="2" Value="1"
                            Style="{StaticResource SliderStyle}" ValueChanged="CIELABAEnhance_Changed"/>
                    <TextBlock x:Name="CIELABBEnhanceLabel" Text="b* Enhancement (1.00)" Style="{StaticResource LabelStyle}"
                               FontWeight="Normal" FontSize="12" Margin="0,4,0,2"
                               ToolTip="Increase blue-yellow contrast"/>
                    <Slider x:Name="CIELABBEnhanceSlider" Minimum="0" Maximum="2" Value="1"
                            Style="{StaticResource SliderStyle}" ValueChanged="CIELABBEnhance_Changed"/>
                    <TextBlock x:Name="CIELABLEnhanceLabel" Text="Lightness Encoding (0.00)" Style="{StaticResource LabelStyle}"
                               FontWeight="Normal" FontSize="12" Margin="0,4,0,2"
                               ToolTip="Encode color differences as brightness differences"/>
                    <Slider x:Name="CIELABLEnhanceSlider" Minimum="0" Maximum="1" Value="0"
                            Style="{StaticResource SliderStyle}" ValueChanged="CIELABLEnhance_Changed"/>

                    <!-- Hidden sliders for transfer (values now controlled by axis control) -->
                    <TextBlock x:Name="CIELABAtoBLabel" Text="a* → b* Transfer (0.50)" Visibility="Collapsed"/>
                    <Slider x:Name="CIELABAtoBSlider" Minimum="-1" Maximum="1" Value="0.5"
                            Visibility="Collapsed" ValueChanged="CIELABAtoB_Changed"/>
                    <TextBlock x:Name="CIELABBtoALabel" Text="b* → a* Transfer (0.00)" Visibility="Collapsed"/>
                    <Slider x:Name="CIELABBtoASlider" Minimum="-1" Maximum="1" Value="0"
                            Visibility="Collapsed" ValueChanged="CIELABBtoA_Changed"/>
                </StackPanel>
            </StackPanel>

            <!-- Daltonization Settings -->
            <StackPanel x:Name="DaltonizationPanel" Visibility="Collapsed">
                <TextBlock Text="CVD Type to Correct" Style="{StaticResource LabelStyle}"/>
                <ComboBox x:Name="DaltonizationCVDCombo" SelectionChanged="DaltonizationCVD_Changed" Margin="0,0,0,8">
                    <ComboBoxItem Content="Protanopia (red-blind)"/>
                    <ComboBoxItem Content="Protanomaly (red-weak)"/>
                    <ComboBoxItem Content="Deuteranopia (green-blind)" IsSelected="True"/>
                    <ComboBoxItem Content="Deuteranomaly (green-weak)"/>
                    <ComboBoxItem Content="Tritanopia (blue-blind)"/>
                    <ComboBoxItem Content="Tritanomaly (blue-weak)"/>
                </ComboBox>
                <TextBlock x:Name="DaltonizationStrengthLabel" Text="Strength (1.00)" Style="{StaticResource LabelStyle}"/>
                <Slider x:Name="DaltonizationStrengthSlider" Minimum="0" Maximum="1" Value="1"
                        Style="{StaticResource SliderStyle}" ValueChanged="DaltonizationStrength_Changed"/>
            </StackPanel>

            <!-- LUT-Based Settings -->
            <StackPanel x:Name="LUTPanel">
                <!-- Preset -->
                <TextBlock Text="Preset" Style="{StaticResource LabelStyle}"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <ComboBox x:Name="PresetCombo" Grid.Column="0" Margin="0,0,8,0"
                              SelectionChanged="PresetCombo_SelectionChanged"/>
                    <Button x:Name="ApplyPresetButton" Grid.Column="1" Content="Apply"
                            Click="ApplyPreset_Click" Padding="12,4"/>
                </Grid>

                <!-- Custom Preset Buttons -->
                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                    <Button x:Name="SaveAsPresetButton" Content="Save As..."
                            Click="SaveAsPreset_Click" Padding="8,4" Margin="0,0,4,0"
                            ToolTip="Save current settings as a new custom preset"/>
                    <Button x:Name="UpdatePresetButton" Content="Update"
                            Click="UpdatePreset_Click" Padding="8,4" Margin="0,0,4,0"
                            IsEnabled="False"
                            ToolTip="Update the selected custom preset with current settings"/>
                    <Button x:Name="ExportPresetButton" Content="Export"
                            Click="ExportPreset_Click" Padding="8,4" Margin="0,0,4,0"
                            ToolTip="Export selected preset to file"/>
                    <Button x:Name="ImportPresetButton" Content="Import"
                            Click="ImportPreset_Click" Padding="8,4" Margin="0,0,4,0"
                            ToolTip="Import preset from file"/>
                    <Button x:Name="DeletePresetButton" Content="Delete"
                            Click="DeletePreset_Click" Padding="8,4"
                            IsEnabled="False"
                            ToolTip="Delete the selected custom preset"/>
                </StackPanel>

                <local:CorrectionEditor x:Name="CorrectionEditor" Margin="0,8,0,0"/>
            </StackPanel>
        </StackPanel>

        <!-- Intensity -->
        <StackPanel x:Name="IntensityPanel" Visibility="Collapsed">
            <TextBlock x:Name="IntensityLabel" Text="Intensity (1.00)" Style="{StaticResource LabelStyle}"/>
            <Slider x:Name="IntensitySlider" Minimum="0" Maximum="1" Value="1"
                    ValueChanged="Intensity_Changed"/>
        </StackPanel>
    </StackPanel>
</UserControl>
